/*
  # Fix All Munro Prominence Values - Efficient Single UPDATE

  1. Problem
    - 158 of 282 Munros still have incorrect prominence (equal to height)
    - Previous approaches had name-matching issues

  2. Solution
    - Single UPDATE with CASE statement matching by height
    - Height is unique enough to identify each Munro precisely
    - Updates all 282 Munros with correct prominence from DoBIH v18.3

  3. Data Source
    - Database of British and Irish Hills v18.3
    - Downloaded: https://www.hill-bagging.co.uk/dobih-downloads/hillcsv.zip
*/

UPDATE munros
SET prominence_m = CASE
  WHEN height_m = 930.4 THEN 646.9
  WHEN height_m = 985.3 THEN 834.3
  WHEN height_m = 973 THEN 252.1
  WHEN height_m = 1173.9 THEN 986
  WHEN height_m = 1164.8 THEN 304.4
  WHEN height_m = 1045.9 THEN 549
  WHEN height_m = 995.9 THEN 474
  WHEN height_m = 973.7 THEN 820
  WHEN height_m = 945.8 THEN 121.8
  WHEN height_m = 932.2 THEN 313
  WHEN height_m = 1131.4 THEN 876
  WHEN height_m = 1029.8 THEN 341.2
  WHEN height_m = 1012.2 THEN 713
  WHEN height_m = 978.6 THEN 198.9
  WHEN height_m = 948.5 THEN 592
  WHEN height_m = 942.8 THEN 632
  WHEN height_m = 926.8 THEN 290
  WHEN height_m = 916.3 THEN 139.9
  WHEN height_m = 915.8 THEN 424
  WHEN height_m = 1083.3 THEN 716
  WHEN height_m = 1080.6 THEN 650
  WHEN height_m = 1076 THEN 332
  WHEN height_m = 1043 THEN 466.9
  WHEN height_m = 1038.6 THEN 226
  WHEN height_m = 1029.5 THEN 188.5
  WHEN height_m = 1004 THEN 247
  WHEN height_m = 981 THEN 136
  WHEN height_m = 967.5 THEN 102.2
  WHEN height_m = 959.5 THEN 481
  WHEN height_m = 952.5 THEN 315
  WHEN height_m = 932.1 THEN 321.1
  WHEN height_m = 1214.3 THEN 914
  WHEN height_m = 1117.1 THEN 126
  WHEN height_m = 1123.1 THEN 198
  WHEN height_m = 1103.4 THEN 109.1
  WHEN height_m = 1077.4 THEN 579
  WHEN height_m = 1067.2 THEN 201.3
  WHEN height_m = 1046.8 THEN 394
  WHEN height_m = 1043.6 THEN 494.4
  WHEN height_m = 1039.8 THEN 492
  WHEN height_m = 1024.9 THEN 450
  WHEN height_m = 1001 THEN 167
  WHEN height_m = 959.3 THEN 554
  WHEN height_m = 925.6 THEN 150.5
  WHEN height_m = 920.1 THEN 311
  WHEN height_m = 967.7 THEN 623
  WHEN height_m = 952.3 THEN 120.3
  WHEN height_m = 1149.4 THEN 844
  WHEN height_m = 1072 THEN 128
  WHEN height_m = 1024.2 THEN 729
  WHEN height_m = 1021.4 THEN 532
  WHEN height_m = 1002.1 THEN 245.1
  WHEN height_m = 994 THEN 415
  WHEN height_m = 959 THEN 510
  WHEN height_m = 958 THEN 469
  WHEN height_m = 953.4 THEN 134.5
  WHEN height_m = 937 THEN 662
  WHEN height_m = 924.5 THEN 177.7
  WHEN height_m = 1127 THEN 880
  WHEN height_m = 1107.9 THEN 795
  WHEN height_m = 1099.8 THEN 169.4
  WHEN height_m = 1089.2 THEN 392
  WHEN height_m = 1079.5 THEN 448.8
  WHEN height_m = 1044.9 THEN 307
  WHEN height_m = 999.2 THEN 134.5
  WHEN height_m = 997.7 THEN 231.3
  WHEN height_m = 989 THEN 425
  WHEN height_m = 980 THEN 252
  WHEN height_m = 928.1 THEN 174.5
  WHEN height_m = 1344.5 THEN 1344.5
  WHEN height_m = 1234 THEN 404
  WHEN height_m = 1220.4 THEN 133
  WHEN height_m = 1220 THEN 162
  WHEN height_m = 1177 THEN 446
  WHEN height_m = 1130 THEN 759
  WHEN height_m = 1116 THEN 74
  WHEN height_m = 1115 THEN 611
  WHEN height_m = 1105 THEN 140
  WHEN height_m = 1099 THEN 316
  WHEN height_m = 1094 THEN 159
  WHEN height_m = 1054.3 THEN 96.8
  WHEN height_m = 1031.8 THEN 152.8
  WHEN height_m = 1010 THEN 271
  WHEN height_m = 999.7 THEN 237.1
  WHEN height_m = 981.5 THEN 151.7
  WHEN height_m = 981.3 THEN 124.5
  WHEN height_m = 977 THEN 174
  WHEN height_m = 943 THEN 197
  WHEN height_m = 939.3 THEN 92.3
  WHEN height_m = 1148 THEN 783
  WHEN height_m = 1132 THEN 410
  WHEN height_m = 1115.8 THEN 99
  WHEN height_m = 1103.3 THEN 127
  WHEN height_m = 1087.8 THEN 540
  WHEN height_m = 1049.7 THEN 311
  WHEN height_m = 1046 THEN 644
  WHEN height_m = 1034 THEN 158
  WHEN height_m = 1019 THEN 186
  WHEN height_m = 979 THEN 90
  WHEN height_m = 954.7 THEN 300
  WHEN height_m = 941 THEN 221
  WHEN height_m = 935 THEN 406
  WHEN height_m = 1010.2 THEN 555
  WHEN height_m = 991.4 THEN 182
  WHEN height_m = 973.2 THEN 112
  WHEN height_m = 950.8 THEN 466
  WHEN height_m = 940.8 THEN 328.1
  WHEN height_m = 936 THEN 109
  WHEN height_m = 917.1 THEN 178
  WHEN height_m = 1008.7 THEN 473
  WHEN height_m = 1006.5 THEN 319
  WHEN height_m = 963.5 THEN 317
  WHEN height_m = 1121.9 THEN 658
  WHEN height_m = 1070 THEN 222.4
  WHEN height_m = 1051 THEN 384
  WHEN height_m = 1045 THEN 247
  WHEN height_m = 1029 THEN 258
  WHEN height_m = 976.1 THEN 299
  WHEN height_m = 975.8 THEN 207.1
  WHEN height_m = 945.1 THEN 186.9
  WHEN height_m = 933 THEN 127.1
  WHEN height_m = 915.3 THEN 122.1
  WHEN height_m = 1155.7 THEN 671
  WHEN height_m = 1109.9 THEN 72.9
  WHEN height_m = 1067.7 THEN 195.2
  WHEN height_m = 1063.1 THEN 118.9
  WHEN height_m = 1047 THEN 85
  WHEN height_m = 1018.8 THEN 61.6
  WHEN height_m = 1011.1 THEN 76
  WHEN height_m = 997.1 THEN 63.9
  WHEN height_m = 988.2 THEN 70.7
  WHEN height_m = 957.8 THEN 73.7
  WHEN height_m = 947.6 THEN 136.9
  WHEN height_m = 939.4 THEN 312
  WHEN height_m = 928.6 THEN 112
  WHEN height_m = 1309.3 THEN 950
  WHEN height_m = 1296 THEN 461
  WHEN height_m = 1291 THEN 166
  WHEN height_m = 1258 THEN 118
  WHEN height_m = 1244.8 THEN 145.8
  WHEN height_m = 1196 THEN 456.2
  WHEN height_m = 1182.9 THEN 254
  WHEN height_m = 1172 THEN 198
  WHEN height_m = 1157 THEN 258
  WHEN height_m = 1155.8 THEN 142
  WHEN height_m = 1113.4 THEN 138.8
  WHEN height_m = 1090 THEN 283
  WHEN height_m = 1037 THEN 231
  WHEN height_m = 1006.9 THEN 90.6
  WHEN height_m = 930.3 THEN 80.9
  WHEN height_m = 945.7 THEN 591
  WHEN height_m = 929.3 THEN 108.3
  WHEN height_m = 926.3 THEN 101.1
  WHEN height_m = 920.3 THEN 71.6
  WHEN height_m = 1128.1 THEN 868
  WHEN height_m = 1052.5 THEN 107
  WHEN height_m = 1049.1 THEN 227
  WHEN height_m = 1006.1 THEN 86.9
  WHEN height_m = 914.6 THEN 301.5
  WHEN height_m = 1035.1 THEN 767.7
  WHEN height_m = 1026.6 THEN 708
  WHEN height_m = 1019.5 THEN 493
  WHEN height_m = 1011.5 THEN 334
  WHEN height_m = 995.9 THEN 259.5
  WHEN height_m = 985.2 THEN 101.3
  WHEN height_m = 980.3 THEN 137.6
  WHEN height_m = 974 THEN 500
  WHEN height_m = 946.2 THEN 79.6
  WHEN height_m = 946 THEN 247
  WHEN height_m = 917.2 THEN 196
  WHEN height_m = 1040.2 THEN 839
  WHEN height_m = 1020 THEN 795
  WHEN height_m = 1012.9 THEN 169.5
  WHEN height_m = 1003 THEN 341
  WHEN height_m = 953.8 THEN 221.7
  WHEN height_m = 945.5 THEN 497
  WHEN height_m = 938.6 THEN 256.6
  WHEN height_m = 918.8 THEN 552
  WHEN height_m = 936.2 THEN 621
  WHEN height_m = 916.8 THEN 305.5
  WHEN height_m = 987 THEN 842
  WHEN height_m = 963 THEN 614
  WHEN height_m = 956.3 THEN 231.8
  WHEN height_m = 1182.8 THEN 1147
  WHEN height_m = 1179.4 THEN 132.4
  WHEN height_m = 1149.7 THEN 433
  WHEN height_m = 1112.7 THEN 149.8
  WHEN height_m = 1068.8 THEN 665
  WHEN height_m = 1053.7 THEN 181.4
  WHEN height_m = 1036 THEN 311
  WHEN height_m = 1031.9 THEN 647
  WHEN height_m = 1027 THEN 178
  WHEN height_m = 1004.8 THEN 173
  WHEN height_m = 1002 THEN 134
  WHEN height_m = 982 THEN 144
  WHEN height_m = 981.1 THEN 390.5
  WHEN height_m = 956 THEN 91
  WHEN height_m = 919.7 THEN 123.8
  WHEN height_m = 918 THEN 407
  WHEN height_m = 1120 THEN 786
  WHEN height_m = 1109 THEN 382
  WHEN height_m = 1100.9 THEN 151.3
  WHEN height_m = 1083.7 THEN 819
  WHEN height_m = 1053 THEN 568
  WHEN height_m = 1049.2 THEN 148.1
  WHEN height_m = 1004.9 THEN 10.5
  WHEN height_m = 999.3 THEN 133
  WHEN height_m = 993 THEN 226
  WHEN height_m = 992 THEN 137
  WHEN height_m = 987.5 THEN 443
  WHEN height_m = 945 THEN 208.2
  WHEN height_m = 925.7 THEN 592
  WHEN height_m = 1151.9 THEN 841
  WHEN height_m = 1129 THEN 302
  WHEN height_m = 1069 THEN 207
  WHEN height_m = 992.3 THEN 197.5
  WHEN height_m = 1054.8 THEN 957
  WHEN height_m = 1023.9 THEN 152.1
  WHEN height_m = 986 THEN 601
  WHEN height_m = 922 THEN 155
  WHEN height_m = 960.7 THEN 723
  WHEN height_m = 926 THEN 271
  WHEN height_m = 1062.6 THEN 757
  WHEN height_m = 1058.7 THEN 141.7
  WHEN height_m = 1015.2 THEN 591
  WHEN height_m = 981 THEN 626
  WHEN height_m = 965.8 THEN 443
  WHEN height_m = 933.8 THEN 207.1
  WHEN height_m = 918.7 THEN 169.8
  WHEN height_m = 1108.9 THEN 914
  WHEN height_m = 1093 THEN 229
  WHEN height_m = 999.6 THEN 450.8
  WHEN height_m = 998.6 THEN 182.9
  WHEN height_m = 954.2 THEN 107
  WHEN height_m = 949.7 THEN 112.3
  WHEN height_m = 934 THEN 115
  WHEN height_m = 923 THEN 109
  WHEN height_m = 924 THEN 148.3
  WHEN height_m = 1084 THEN 810
  WHEN height_m = 977.8 THEN 164.8
  WHEN height_m = 976.8 THEN 126.6
  WHEN height_m = 953 THEN 367
  WHEN height_m = 927 THEN 166
  WHEN height_m = 1046 THEN 691
  WHEN height_m = 962.1 THEN 819
  WHEN height_m = 998.9 THEN 836
  WHEN height_m = 987.6 THEN 102
  WHEN height_m = 985.8 THEN 187.6
  WHEN height_m = 972.1 THEN 123
  WHEN height_m = 965 THEN 114
  WHEN height_m = 966.1 THEN 205
  WHEN height_m = 958.8 THEN 126
  WHEN height_m = 948.1 THEN 56
  WHEN height_m = 944.1 THEN 89
  WHEN height_m = 928.8 THEN 859
  WHEN height_m = 966 THEN 966
  WHEN height_m = 941.4 THEN 136.9
  ELSE prominence_m
END;

-- Verify results
SELECT
  COUNT(*) as total_munros,
  SUM(CASE WHEN prominence_m = height_m THEN 1 ELSE 0 END) as still_incorrect,
  SUM(CASE WHEN prominence_m != height_m THEN 1 ELSE 0 END) as now_correct,
  ROUND(100.0 * SUM(CASE WHEN prominence_m != height_m THEN 1 ELSE 0 END) / COUNT(*), 1) as percent_correct
FROM munros;
